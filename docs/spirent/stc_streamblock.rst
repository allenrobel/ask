*****************************************************************************
StcStreamblock() - spirent/stc_streamblock.py
*****************************************************************************

.. contents::
   :local:
   :depth: 1

ScriptKit Synopsis
------------------
StcStreamblock() facilitates generation of Ansible playbooks to create
Spirent StreamBlocks to send traffic between Spirent emulated devices.

See StcStreamblockBgpRoutes() for creating StreamBlocks to send traffic
between BGP routes.

StcStreamblock() generate Ansible task instances conformant with
Spirent Ansible implementation for their LabServer + TestCenter products.
These task instances can then be passed to Playbook().add_task()

Caveats
-------

1.  The following throws an error.  We are working with Spirent on this:

        action = 'delete'

2.  Spirent Ansible currently does not perform error-checking to 
    ensure that the value of traffic_pattern is appropriate for 
    the defined endpoints.  For example, if traffic_pattern = 'PAIR',
    but the number of source and destination endpoints is unequal,
    Spirent will accept this as a valid configuration (i.e.
    the Playbook will succeed). Later, when the user tries to
    start ArpNd, or tries to start traffic, Spirent will then throw
    an error.

3.  Spirent Ansible currently does not perform error-checking to
    ensure that the "under" property value is appropriate for the
    set of SrcBinding-targets the user has defined.  So, for 
    example, if the user set port_name = 'POD1_TOR2_PORT10', ScriptKit
    will translate this into:

        under: ref:/Port[@Name='POD1_TOR2_PORT10']

    If there are SrcBinding-targets hosted on other ports, for
    this StreamBlock, this will be an invalid configuration. Spirent 
    will not detect this invalid configuration and will accept
    the StreamBlock (and configure it).  Later, when the user tries 
    to start ArpNd, and/or start traffic, an error will be thrown.

    The correct configuration in this case would be for the user NOT
    to set port_name, which would result in:

        under: ref:/project

Ansible Module Documentation
----------------------------

    - `Spirent stc-ansible <https://github.com/Spirent/stc-ansible>`_

Prerequisites
-------------

    1.  To run playbooks generated by StcStreamBlock()
        `Spirent stc-ansible <https://github.com/Spirent/stc-ansible>`_ 
        and its dependencies (e.g. paramiko) must be installed.

ScriptKit Example
-----------------

    - `unit_test/spirent/unit_test_stc_streamblock.py <https://github.com/allenrobel/ask/blob/main/unit_test/spirent/unit_test_stc_streamblock.py>`_

Properties
----------

====================================    ==================================================
Property                                Description
====================================    ==================================================
action                                  create or delete the StreamBlock::

                                            - Type: str()
                                            - Spirent name: action
                                            - Valid values: create, delete
                                            - Default: create

count                                   Increments Ansible var $item from 1 to count.
                                        This can be used to increment something in the
                                        playbook::

                                            - Type: int()
                                            - Spirent name: count
                                            - Default: 1

load                                    In conjunction with load_unit, determines
                                        the rate at which traffic is sent.::

                                            - Type: int() or float()
                                            - Spirent name: Load
                                            - Examples:
                                                - task.load = 99.2
                                                - task.load = 50000
                                            - See also: load_unit
                                            - Required if action is create

load_unit                               The unit of measure for the traffic rate.
                                        For example, if load_unit is PERCENT_LINE_RATE
                                        and load is 24.4, then the interface speed is
                                        taken into account to determine the actual
                                        rate.  If load_unit is FRAMES_PER_SECOND, and
                                        load is 100, then traffic will be sent at an
                                        absolute rate of 100 packets per second.::

                                            - Type: str()
                                            - Spirent name: LoadUnit
                                            - Valid values:
                                                - BITS_PER_SECOND
                                                - FRAMES_PER_SECOND
                                                - INTER_BURST_GAP
                                                - INTER_BURST_GAP_IN_MILLISECONDS
                                                - INTER_BURST_GAP_IN_NANOSECONDS
                                                - KILOBITS_PER_SECOND
                                                - L2_RATE
                                                - MEGABITS_PER_SECOND
                                                - PERCENT_LINE_RATE
                                            - Examples:
                                                - task.load_unit = 'BITS_PER_SECOND'
                                            - See also: load
                                            - Required if action is create

name                                    Name of the StreamBlock.::

                                            - Type: str()
                                            - Spirent name: Name
                                            - Examples:
                                                - task.name = 'my_streamblock'
                                            - Required

port_name                               The name of the port under which to create
                                        the StreamBlock.  If not set, the StreamBlock
                                        will be created under ref:/project.  If set,
                                        use the name you gave to the port when you
                                        created the port.::

                                            - Type: str()
                                            - Spirent name: under
                                            - Default: ref:/project
                                            - NOTES:

                                            1.  If tx_device is set to a partial device name that
                                                expands to devices that exist on multiple ports,
                                                port_name must NOT be set.  For example, the following
                                                is invalid (assuming a device named Device511 lives on 
                                                MyPort1 and a device named Device512 lives on, say, 
                                                MyPort2.

                                                task.tx_name = 'Device51'
                                                task.tx_type = 'device'
                                                task.tx_selector = 'STARTS_WITH'
                                                task.tx_protocol = 'ipv4'
                                                task.port_name = 'MyPort1'

                                                Spirent Ansible will accept the above without,
                                                error, but it will generate an error later when
                                                you try to start traffic and/or start ArpNd.

                                            Examples:

                                            
                                                task.port_name = 'MyPort5'

                                                The above results in the 'under' property being 
                                                set as follows:

                                                under: ref:/Port[@Name='MyPort5']

                                                task.port_name = None (or, omitting task.port_name)

                                                The above results in the 'under' property being set 
                                                as follows:

                                                under: ref:/project

rx_name                                 The name of the rx entity.  If rx_type is
                                        device, then rx_name should be the name of an
                                        emulated device.  This is used, along with
                                        rx_type, and rx_protocol, to construct the
                                        Spirent DstBinding-targets value::

                                            - Type: str()
                                            - Spirent name: none
                                            - Examples:
                                                - task.rx_name = 'my_rx_device'
                                            - Required if action is create

rx_protocol                             The protocol of the rx entity.  This is used, 
                                        along with rx_name, and rx_type, to construct
                                        the Spirent DstBinding-targets value::

                                            - Type: str()
                                            - Valid values: ipv4, ipv6
                                            - Spirent name: none
                                            - Examples:
                                                - task.rx_protocol = 'ipv4'
                                            - Required if action is create

rx_type                                 The type of the rx entity.  This currently
                                        allows for a single value: device. This is used, 
                                        along with rx_name, and rx_protocol, to construct
                                        the Spirent DstBinding-targets value::

                                            - Type: str()
                                            - Valid values: device
                                            - Spirent name: none
                                            - Examples:
                                                - task.rx_type = 'device'
                                            - Required if action is create

rx_selector                             An optional selector that determines how
                                        rx_name is interpreted.::

                                            - Type: str()
                                            - Valid values:
                                              - EQUAL        "=": Selector.equal
                                              - NOT_EQUAL    "!=" Selector.different
                                              - CONTAINS     "~=" Selector.contains
                                              - STARTS_WITH  "^=" Selector.startswith
                                            - DEFAULT: EQUAL
                                            - Examples:

                                            If rx_name is set to "rx_host", then the following hold:

                                            - rx_selector = 'EQUAL'

                                                "rx_host" is selected (single device)

                                            - rx_selector = 'NOT_EQUAL'

                                                Multiple devices would be selected, if their
                                                name (rx_name) does not contain "rx_host" e.g.:

                                                "tx_host"
                                                "rx_host_45"
                                                "foobar_server"

                                            - rx_selector = 'CONTAINS'

                                                Multiple devices would be selected, if their
                                                name (rx_name) contains "rx_host" e.g.:

                                                "my_rx_host"
                                                "rx_host_45"
                                                "rx_host"

                                            - rx_selector = 'STARTS_WITH'

                                                Multiple devices would be selected, if their
                                                name (rx_name) starts with "rx_host" e.g.:

                                                "rx_host_44"
                                                "rx_host_EAST"
                                                "rx_host"

stream_only_generation                  Set to True to use streams rather than VFDs 
                                        (Variable Field Definitions) to generate traffic
                                        between endpoints.::

                                            - Type: bool()
                                            - Valid values: False, True
                                            - Default: True
                                            - Spirent name: EnableStreamOnlyGeneration
                                            - Examples:
                                                - task.stream_only_generation = False

traffic_pattern                         Determines the pattern used between sources
                                        and destinations.::

                                            - Type: str()
                                            - Valid values: BACKBONE, MESH, PAIR
                                            - Spirent name: TrafficPattern
                                            - Required if action is create

tx_name                                 The name of the tx entity.  If tx_type is
                                        device, then tx_name should be the name of an
                                        emulated device.  This is used, along with
                                        tx_type, and tx_protocol, to construct the
                                        Spirent SrcBinding-targets value::

                                            - Type: str()
                                            - Spirent name: none
                                            - Examples:
                                                - task.tx_name = 'my_tx_device'
                                            - Required if action is create

tx_protocol                             The protocol of the tx entity.  This is used, 
                                        along with tx_name, and tx_type, to construct
                                        the Spirent SrcBinding-targets value::

                                            - Type: str()
                                            - Valid values: ipv4, ipv6
                                            - Spirent name: none
                                            - Examples:
                                                - task.tx_protocol = 'ipv4'
                                            - Required if action is create

tx_selector                             An optional selector that determines how
                                        tx_name is interpreted.::

                                            - Type: str()
                                            - Valid values:
                                              - EQUAL        "=": Selector.equal
                                              - NOT_EQUAL    "!=" Selector.different
                                              - CONTAINS     "~=" Selector.contains
                                              - STARTS_WITH  "^=" Selector.startswith
                                            - DEFAULT: EQUAL
                                            - Examples:

                                            If tx_name is set to "tx_host", then the following hold:

                                            - tx_selector = 'EQUAL'
                                            
                                                "tx_host" is selected (single device)

                                            - tx_selector = 'NOT_EQUAL'
                                            
                                                Multiple devices would be selected, if their
                                                name (tx_name) does not contain "tx_host" e.g.:

                                                "rx_host"
                                                "rx_host_45"
                                                "foobar_server"

                                            - tx_selector = 'CONTAINS'
                                            
                                                Multiple devices would be selected, if their
                                                name (tx_name) contains "tx_host" e.g.:

                                                "my_tx_host"
                                                "tx_host_45"
                                                "tx_host"

                                            - rx_selector = 'STARTS_WITH'
                                            
                                                Multiple devices would be selected, if their
                                                name (tx_name) starts with "tx_host" e.g.:

                                                "tx_host_44"
                                                "tx_host_EAST"
                                                "tx_host"

tx_type                                 The type of the tx entity.  This currently
                                        allows for a single value: device. This is used, 
                                        along with tx_name, and tx_protocol, to construct
                                        the Spirent SrcBinding-targets value::

                                            - Type: str()
                                            - Valid values: device
                                            - Spirent name: none
                                            - Examples:
                                                - task.tx_type = 'device'
                                            - Required if action is create

====================================    ==================================================
